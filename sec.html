<!-- קוד הגנה של Firebase (להדביק ב-<head> של כל דף מוגן) -->
<script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

        // 1. אותו Config בדיוק כמו בדף הכניסה
        const firebaseConfig = {
          apiKey: "AIzaSyDqxxf434N0wnn6C6AglEEIaqj5TVtoYLQ",
          authDomain: "memshalaa.firebaseapp.com",
          projectId: "memshalaa",
          storageBucket: "memshalaa.firebasestorage.app",
          messagingSenderId: "324187090365",
          appId: "1:324187090365:web:8e4956d0d1370b5aab36d4",
          measurementId: "G-2QHJF3SSJQ"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // 2. ה"שומר" - בודק אם יש משתמש מחובר
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // משתמש מחובר - הכל בסדר, מציגים את הדף
                console.log("משתמש מורשה:", user.email);
                
                // --- אופציונלי: עדכון UI ---
                // הקוד הזה יחפש אלמנטים עם ה-ID שכתוב ויעדכן אותם.
                // אם אין לך אלמנטים כאלה, הוא פשוט ידלג.
                const userInfo = document.getElementById('userInfo');
                const loginLink = document.getElementById('loginLink');
                const logoutButton = document.getElementById('logoutButton');

                if (userInfo) userInfo.innerText = `מחובר כ: ${user.email}`;
                if (loginLink) loginLink.style.display = 'none';
                if (logoutButton) logoutButton.style.display = 'block';
                // -------------------------

                document.body.style.display = 'block'; // מציג את הגוף רק אחרי אימות
            } else {
                // אין משתמש מחובר - זרוק אותו לדף הכניסה
                window.location.href = 'login.html'; 
            }
        });
        
        // פונקציית התנתקות גלובלית
        window.logout = function() {
            signOut(auth).then(() => {
                window.location.href = 'login.html'; 
            });
        }
    </script>
    
    <!-- הסתרת הדף עד שהבדיקה מסתיימת כדי למנוע הבהוב -->
    <style> 
        body { display: none; } 
        /* הסתרת כפתור התנתקות כברירת מחדל */
        #logoutButton { display: none; } 
    </style>